// Generated by CoffeeScript 1.8.0
(function() {
  var Apollon;

  Apollon = { module: void 0,
		    base_url: void 0,
		    body_id: void 0,
		    menu: void 0,
		    search_оverlay: void 0,
		    search_input: void 0,
		    intent: void 0,
		    footer: void 0,
		    menu_width: void 0,
		    fixed_logo: void 0,
		    url: function(rel_url) {
		      return this.base_url + rel_url.replace(/^\/+/, "");
		    },
		    jsonURL: function(url) {
		      var result;
		      result = url;
		      if (!result) {
		        result = document.location.href;
		      }
		      if (result.indexOf('?') === -1) {
		        result += '?';
		      }
		      if (result.substr(-1) !== '?') {
		        result += '&';
		      }
		      result += '___xhr';
		      return result;
		    },
    init: function() {
      var body, comments, lastScrollTop, main_img_cont, scroll_timeout;
      this.module = $('main');
      this.footer = $('footer');
      this.body_id = $('body').attr('id');
      this.menu = $('nav');
      this.fixed_logo = $('.fixed-logo');
      this.base_url = $('body').data('base-url').replace(/\/+$/, "") + "/";
    	$('body').ready(function(){
    		setTimeout(function() {
    			$('body').removeClass('busy');
    		},500);
    	});
    	
    	var bps = String($(document.body).data('responsive-bp'));
    	new ResponsiveBP(_.map(bps.split(","), function (i) { return parseInt(i) } ));
    	
      $('.initially-hidden').removeClass("initially-hidden").hide();
      switch (this.module.attr('id')) {
        case 'home':
          this.Home.init();
          break;
        case 'news':
    	  this.News.init();
    	  break;
        case 'about':
	      this.About.init();
	      break;
        case 'trainers':
          this.Trainers.init();
          break;
        case 'gallery':
          this.Gallery.init();
          break;
        case 'album':
        	this.Album.init();
        	break;
        case 'contact':
          this.Contact.init();
          break;
      }
     

      
      Apollon.showFileName();
      $('.cancel').on("click", function(){
    	  var upload_clone = $(".upload_file").clone();
    	  $(".upload_file").remove();
    	  $('.cancel').removeClass("shown");
    	  upload_clone.appendTo(".app_btn");
    	  Apollon.showFileName();
    	  $('.filename').text('');
      });
      
      $('.up-to-top').on('click', function(e) {
        e.preventDefault();
        return $('html, body').animate({
          scrollTop: 0
        }, 800);
      });
      if (!Modernizr.touch) {
        this.setMainMarginBottom();
        $(window).on('resize', (function(_this) {
          return function() {
            return _this.setMainMarginBottom();
          };
        })(this));
      }
      this.setMenuSize();
      $(window).on('resize.menu_width', (function(_this) {
        return function() {
          return _this.setMenuSize();
        };
      })(this));
      this.menu = $('nav');
      this.initTransitionLinks();
      this.menu.on('click', function(e) {
        return e.stopPropagation();
      });
      
      $('.svg-menu').on('click', function() {
    	  $('#index').addClass('opened');
      });
      
      $(document).on('keyup', (function(_this) {
        return function(e) {
          if (e.which === 27) {
            _this.hideMenu();
          }
        };
      })(this));
      
      $(document).on('click', (function(_this) {
        return function() {
          return _this.hideMenu();
        };
      })(this));

      $(window).on('scroll', (function(_this) {
        return function() {
          return _this.setFixedLogoVisibility();
        };
      })(this));
      
      $(".menu-items .transition").hover(																	//light menu item
   		   function(){
    	$(this).css({"background-color":"#082EB7"})
   		   },
   		function(){
   	    	$(this).css({"background-color":"inherit"})
   		}
    ); 
      
		function initMap() {
		  var map = new google.maps.Map(document.getElementById('map_canvas'), {
		    center: {lat: -34.397, lng: 150.644},
		    zoom: 8
		  });
		}
      
    },
    
    showFileName: function () {
    	$('.upload_file').off('change').on('change', function(e) {
    		var t = e.currentTarget;
      	  console.log(1231564);
      	  var file = t.files[0];
           $('.filename').text(file.name);
           $('.cancel').addClass("shown");
        });
    },
    
    setFixedLogoVisibility: function() {
      if ($(window).scrollTop() + $(window).height() > $(document).height() - 400) {
        return this.fixed_logo.addClass('hidden');
      } else {
        return this.fixed_logo.removeClass('hidden');
      }
    },
    
    
    
    setMainMarginBottom: function() {},
    
    showMenu: function() {
      $('body').addClass('menu-animate');
      return this.menu.stop(true, true).animate({
        'margin-right': 0
      }, 300, (function(_this) {
        return function() {
        	$('.menu-btn').addClass('opened')
          return $('body').addClass('menu-is-opened');
        };
      })(this));
    },
    hideMenu: function() {
      $('body').removeClass('menu-is-opened');
       setTimeout((function(_this) {
        return function() {
          $('body').removeClass('menu-animate');
          $('.menu-btn').removeClass('opened')
            _this.menu.stop(true, true).animate({
	            'margin-right': -100 + '%'
	          }, 300);
        };
      })(this), 300);
      return;
    },
    
       
        
    setMenuSize: function() {
      var delta, resp_state, window_width;
      window_width = $(window).width();
      resp_state = window.intent.axes.width.current;
      delta = window_width/2;
      this.menu_width = window_width;
      this.menu.css({
        width: this.menu_width
      });
      if (!$('body').hasClass('menu-is-opened')) {
        return this.menu.css({
          'margin-right': -100 + '%'
        });
      }
    },
    initTransitionLinks: function() {
    },
    initIsotope: function(container, item_selector) {
      return setTimeout(function() {
        return container.imagesLoaded(function() {
          return container.isotope({
            itemSelector: item_selector,
            layoutMode: 'masonry'
          });
        });
      }, 50);
    }
  };
  Apollon.About = {
		    init: function() {
		      $('.about').addClass('selected');
		    }
  }
  Apollon.Album = {
		  init: function() {
			  $('.gallery').addClass('selected');
				    $("a.picture").fancybox();
		  }
  }
  Apollon.Contact = {
    init: function() {
      $('.contact').addClass('selected');
      ymaps.ready(init);
      var myMap,
      	  myPlacemark;
	      function init(){  
		    	  var myMap = new ymaps.Map("map_canvas", {
		    		  center: [50.93773030310689,34.76941707336368], 
		    		  zoom: 17
		    	  });
		    	  myPlacemark = new ymaps.Placemark([50.93773030310689,34.76941707336368], {
		    		  hintContent: 'Apollon', 
		    		  balloonContent: 'Спортивный клуб Аполлон' 
		    	  },{
		    		  iconLayout: 'default#image',
		    		  iconImageHref: 'img/apollon_logo_small.png',
		    		  iconImageSize: [79, 51],
		    		  iconImageOffset: [-3, -42]
		    	  	}
		    	  );
		    	  myMap.geoObjects.add(myPlacemark);
		   }
      }
  }
		
  Apollon.Gallery = {
		  init: function() {
			  $('.gallery').addClass('selected');
			  this.animateArticles();
		      return $(window).on('scroll resize', (function(_this) {
		        return function() {
		          return _this.animateArticles();
		        };
		      })(this)); 
		  },
	  animateArticles: function(is_scroll) {
	    var w_height, w_scroll_top;
	    w_scroll_top = $(window).scrollTop();
	    w_height = $(window).height();
	    return  $('.album-tsr, .menu-item-tsr.layer_square').each((function(_this) {
	      return function(i, e) {
	        var offset, t;
	        t = $(e);
	        offset = t.offset().top;
	        if (offset < w_scroll_top + w_height) {
	          return t.addClass('shown');
	        }
	      };
	    })(this));
  }
};
  
  Apollon.Trainers = {
		  init: function() {
			  $('.trainers').addClass('selected');
		  }
  }
  Apollon.News = {
		    load_more: void 0,
		    load_more_btn: void 0,
		    loader: void 0,
		    articles_cont: void 0,
		    articles: void 0,
		    init: function() {
		      this.load_more = $('#news .load-more');
		      this.load_more_btn = $('a', this.load_more);
		      this.loader = $('.loader');
		      this.sign = $('.btn-text');
		      this.menu_item = $('.menu-item');
		      this.articles_cont = $('#news');
		      this.articles
		      
		      $('.news').addClass('selected');
		      
		      this.load_more.on('click', $.proxy(function (e) {
		    	  console.log('1');
					e.preventDefault();
					if (!this.loader.hasClass('visible')) {
						this.loader.addClass('visible');
						$.get(
							this.load_more_btn.prop("href")
						).always(function () {
							this.loader.removeClass('visible');
						}.bind(this)).success($.proxy(function (data) {
							var $data = $(data); 
							this.articles_cont.append($data.find("#news").children());
							$(window).resize();

							var new_lod_more_btn = $data.find("#news .load-more a");
							if (new_lod_more_btn.length) {
								this.load_more_btn.prop("href", new_lod_more_btn.prop("href"));
							} else {
									this.load_more.remove();
							}
						}, 
					this)).error(function () {
							alert('Something went wrong. Please try again later');
						});
					}
				}, this));
		      
		      this.sign.on('click', $.proxy(function (e) {
					e.preventDefault();
					$('.input-form').addClass('visible');
					$('.name').addClass('visible');
					$('.phone').addClass('visible');
					$('.topform-btn-ok').addClass('visible');
					
					
					$('.topform-btn').remove();
					$('.central-top-form').append('');
		      }))
		      $('.topform-btn-ok').on('click', $.proxy(function (e) {
		    	  e.preventDefault();
		    	  $('.top-btn').click();
		      }))
		    }};
  
  Apollon.Home = {
    load_more: void 0,
    load_more_btn: void 0,
    loader: void 0,
    articles_cont: void 0,
    articles: void 0,
    init: function() {
      this.load_more = $('#container .home .load-more');
      this.load_more_btn = $('a', this.load_more);
      this.loader = $('.loader');
      this.sign = $('.btn-text');
      this.menu_item = $('.menu-item');
      this.articles_cont = $('.news');
      this.fotorama = $('.fotorama-container');
      this.body = $('body');
      this.articles
      
      
      this.load_more.on('click', $.proxy(function (e) {				//load more btn
			e.preventDefault();
			if (!this.loader.hasClass('visible')) {
				this.loader.addClass('visible');
				$.get(
					this.load_more_btn.prop("href")
				).always(function () {
					this.loader.removeClass('visible');
				}.bind(this)).success($.proxy(function (data) {
					var $data = $(data); 
					this.articles_cont.append($data.find(".home .news").children());
					$(window).resize();

					var new_lod_more_btn = $data.find(".home .load-more a");
					if (new_lod_more_btn.length) {
						this.load_more_btn.prop("href", new_lod_more_btn.prop("href"));
					} else {
							this.load_more.remove();
					}
				}, 
			this)).error(function () {
					alert('Something went wrong. Please try again later');
				});
			}
		}, this));
      
      $(window).scroll(function(){
    	  if($(window).scrollTop()>40){
    	  }
      });
      
      this.sign.on('click', $.proxy(function (e) {
			e.preventDefault();
			$('.input-form').addClass('visible');
			$('.name').addClass('visible');
			$('.phone').addClass('visible');
			$('.topform-btn-ok').addClass('visible');
			$('.central-top-form').addClass('extended');
			$('.g-recaptcha').addClass('show-captcha');
			
			$('.topform-btn').remove();
			$('.central-top-form').append('');
      }))
      $('.topform-btn-ok').on('click', $.proxy(function (e) {
    	  e.preventDefault();
    	  $('.top-btn').click();
      }))
      
      this.animateArticles();
      return $(window).on('scroll resize', (function(_this) {
        return function() {
          return _this.animateArticles();
        };
      })(this));
    },
    animateArticles: function(is_scroll) {
      var w_height, w_scroll_top;
      w_scroll_top = $(window).scrollTop();
      w_height = $(window).height();
      return  $('.article-tsr, .menu-item-tsr,.layer_square').each((function(_this) {
        return function(i, e) {
          var offset, t;
          t = $(e);
          offset = t.offset().top;
          if (offset < w_scroll_top + w_height) {
            return t.addClass('shown');
          }
        };
      })(this));
    }};

  window.Apollon = Apollon;

  $($.proxy(Apollon.init, Apollon));

}).call(this);

